---
title: 如何实现虚拟滚动
tags:
  - 功能
---
## 为什么需要虚拟滚动

假设一个 vue 组件用 v-for 一次性不分页渲染 100000 条列表数据，且不说从后端请求这些数据所需要的时间，光是从加载数据到可以交互的时间就能直观感觉到卡顿，数据量越大感觉越明显，这种性能完全无法达到良好的用户体验，但这种一次性渲染大量列表数据的需求其实挺常见，因此需要一种手段优化大数据列表的性能，虚拟滚动就是最主流的解决方案，不过在解释虚拟滚动的原理之前，需要先了解普通渲染出现性能瓶颈的原因
## 分析

首先创建一个 vue 组件用于渲染列表数据

```html title="src/components/NormalScroller.vue"
<script setup lang="ts">
const props = defineProps<{
  // 可视区高度
  height: number
  // 所有数据
  data: { id: number; height: number }[]
}>()
</script>

<template>
  <div id="scroller" :style="{ height: props.height + 'px' }">
    <div class="item" v-for="item in data" :key="item.id" :style="{ height: item.height + 'px' }">
      {{ item.id }}
    </div>
  </div>
</template>

<style scoped>
#scroller {
  border: 1px solid #eee;
  overflow: auto;
}

.item {
  box-sizing: border-box;
  border: 1px solid #eee;
  background-color: #000;
  color: #fff;
}
</style>
```

在父组件中创建数据并向该组件传递数据，每个列表项高度固定

```html title="src/App.vue"
<script setup lang="ts">
import NormalScroller from './components/NormalScroller.vue'
import { ref, type Ref, onMounted } from 'vue'

const data: Ref<{ id: number; height: number }[]> = ref([])

function getData() {
  const temp = []
  for (let i = 0; i < 100000; i++) {
    temp.push({
      id: i + 1,
      height: 50
    })
  }
  data.value = temp
}

onMounted(() => {
  getData()
})
</script>

<template>
  <NormalScroller :height="500" :data="data"></NormalScroller>
</template>
```

把项目跑起来后，打开页面，打开开发者工具，进入开发者工具的 `Performance` 面板，点击左上角的 `Record and reload` 按钮，点击后浏览器就会自动刷新并且开始录制从刷新到加载完成的性能数据（不需要手动点击 `Stop`）

录制完后得到的信息很多，重点关注一下底部 `Summary` 的部分，其中的 `Total` 就表示了加载页面所花费的时间

## 源码

https://github.com/ReinerLau/virtual-scroller.git