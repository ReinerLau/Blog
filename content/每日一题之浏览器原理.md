---
title: 每日一题之浏览器原理
tags:
  - 浏览器原理
  - 八股文
---
## 什么是 XSS 攻击

全称跨站脚本攻击（Cross-Site Scripting），攻击者利用网站本身的漏洞注入 JavaScript 脚本进行恶意攻击

存储型：

```mermaid
sequenceDiagram
box blue 黑客方
participant H as 黑客
participant HS as 恶意服务器
end
box green 用户方
participant U as 用户浏览器
participant US as 正常服务器
end
H->>US:提交带有恶意脚本的数据
Note over US:存储
Note over U:访问网页
U->>US:发起请求
US->>U:返回带有恶意脚本数据的网页
Note over U:解析并执行恶意脚本
U->>HS:提交带有敏感信息的数据
Note over HS:存储
H->>HS:获取
```

反射型：

```mermaid
sequenceDiagram
box blue 黑客方
participant H as 黑客
participant HS as 恶意服务器
end
box green 用户方
participant U as 用户浏览器
participant US as 正常服务器
end
Note over H: 构造带有恶意脚本参数的链接
H->>U: 发送链接
Note over U: 点击链接
Note over U: 访问网页
U->>US: 发起带有恶意脚本参数的请求
US->>U: 返回带有恶意脚本数据的网页
Note over U: 解析并执行恶意脚本
U->>HS: 提交带有敏感信息的数据
Note over HS: 存储
H->>HS: 获取
```

DOM 型：


```mermaid
sequenceDiagram
box blue 黑客方
participant H as 黑客
participant HS as 恶意服务器
end
box green 用户方
participant U as 用户浏览器
end
Note over H: 构造带有恶意脚本参数的链接
H->>U: 发送链接
Note over U: 点击链接
Note over U: 访问网页
Note over U: 代码取出带有恶意脚本的参数并嵌入网页
Note over U: 解析并执行恶意脚本
U->>HS: 提交带有敏感信息的数据
Note over HS: 存储
H->>HS: 获取
```

## 如何防御 XSS 攻击

- 过滤转义：数据库或前端对敏感字符进行过滤或转义，比如 `<` 和 `>` 转义成 `&lt` 和 `&gt`
- CSP：开启 CSP，限制外部资源的加载和内联脚本的执行
- 敏感信息：限制敏感信息的获取方式，比如 cookie 使用 `http-only`，使得脚本无法获取

## 什么是 CSRF 攻击

全称跨站请求伪造攻击（Cross-Site Request Forgery），攻击者利用用户在某个网站的身份凭证，诱导用户向该网络发起恶意请求。比如用户已在某个银行网站登录的情况下，诱导用户点击恶意链接向银行网站发起转账请求，该请求携带了用户登录后的身份凭证，使得网站误以为是本人操作

## 如何防御 CSRF 攻击

- token：用户登录后，服务器生成一个随机 token 字符串，之后在每个请求都中添加 token 头信息，服务器验证每个请求的 token，避免只通过链接就能发起请求的问题，也避免请求自动携带 cookie 的单一验证问题
- SameSite 属性：设置 cookie 的 SameSite 属性，限制跨站请求发送 cookie
- Referer 头：验证请求是从同一域名发起的

## 进程和线程的区别

- 资源分配
	- 进程：操作系统分配资源的基本单位，每个进程有自己的独立内存空间和系统资源
	- 线程：进程的执行单位，同一个进程的多个线程共享内存和系统资源
- 创建开销
	- 进程：需要分配独立资源，开销更大
	- 线程：共享同一进程资源，开销更小
- 稳定性
	- 进程：相互隔离，一个进程崩溃不会影响其他进程
	- 线程：一个线程出错可能会导致整个进程崩溃

## 浏览器缓存机制

- 首次请求资源
	- 缓存资源
	- 缓存相关响应头信息作为后续请求头
- 后续请求资源
	- 强缓存判断：是否允许浏览器直接使用本地缓存的资源，而无需向服务器发送请求，适用于不常改动的静态资源
		- 优先判断请求头 `Cache-Control` 的 `max-age`：缓存有效的时间长度
		- 判断请求头 `Expires`：表示缓存失效的具体日期时间
	- 协商缓存判断：请求服务器是否需要重新下载资源，不需要则返回 304，表示可以继续使用本地缓存的资源，适用于随时可能改动的资源
		- 优先判断请求头 `If-Node-Match`：表示资源的唯一标识符, 资源内容没有改动就不会变，服务器将其与响应头 `Etag` 比对
		- 判断请求头 `If-Modified-Since`：表示资源的最后修改时间, 服务器将其与响应头 `Last-modified` 比对

## 常见浏览器内核

- Chrome、Edge 浏览器：Blink 内核，Webkit 内核的分支
- Firfox 浏览器：俗称 Firfox 内核
- Safari 浏览器：Webkit 内核
- IE 浏览器：俗称 IE 内核