---
title: 如何实现低延时视频监控
tags:
  - 功能
---
## 需求

项目使用到海康威视的摄像头设备, 该摄像头会生成 rtsp 地址, 只要使用一些前端第三方库对地址的视频流进行解码编码就能在浏览器播放, 但是因为前端解码编码的性能有限, 会导致播放有极大延迟, 对监控场景来说, 实时性十分重要

## WebRTC

目前是主流浏览器原生支持的技术, 主要作用是实现实时通信, 其原理是通过点对点实现低延迟通信, 所谓点对点就是两个节点直接相互通信, 没有中间服务器参与

## SRS

是一个开源的实时视频服务器, 支持多种流媒体协议, 其中就支持将 rtsp 协议转为 webrtc 协议

### 启动

docker 启动 srs

```sh
docker run --name=srs --restart=always -d -p 1935:1935 -p 1985:1985 -p 8080:8080 registry.cn-hangzhou.aliyuncs.com/ossrs/srs:5
```

- `--name=srs` 容器名为 `srs`
- `--restart=always` docker 开启后容器会自动重启
- `-d` 后台运行容器
- `-p` 映射容器端口到本机端口
- `registry.cn-hangzhou.aliyuncs.com/ossrs/srs:5` 镜像

启动容器成功后, 打开 http://localhost:8080/players/rtc_player.html 就能看到播放视频的页面, 输入 webrtc 地址就能播放视频, 但此时我们还没有 webrtc 的视频流地址, 下面我们使用 OBS Studio 生成

### 推流

打开 OBS studio 后, 在底部添加采集源, 点击 `+` 号后选择`屏幕采集`, 进入`设置 - 直播`, `服务`选择`自定义`, `服务器`填 `rtmp://` 加上 srs 容器运行所在服务器的域名, 比如 `rtmp://localhost`, `推流码`任意填, 比如 `test`, 然后`确定`, 最后点`开始直播`, 如果没有报错说明推流成功了, 将当前电脑屏幕的画面作为视频流推送到 srs 服务上

最终会生成 `webrtc://localhost/test` 的视频流地址, 进入 http://localhost:8080/players/rtc_player.html 输入该地址就能看到画面, 这个步骤也叫拉流

### 拉流






